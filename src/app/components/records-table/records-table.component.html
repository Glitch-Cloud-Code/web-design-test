<form class="table-form">
  <table mat-table [dataSource]="dataSource" matSort matSortActive="id" matSortDirection="asc" matSortDisableClear
    class="mat-elevation-z8">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
      <td mat-cell *matCellDef="let record"> {{record.id}} </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
      <td mat-cell *matCellDef="let record">
        <ng-container *ngIf="record.id && record.id !== editedRecordId">
          {{record.name}}
        </ng-container>
        <ng-container *ngIf="record.id && record.id === editedRecordId">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="tableForm.controls['nameEditField']" placeholder="Name" name="name"
              [(ngModel)]="editRecord.name" value="{{editRecord.name}}">
          </mat-form-field>
        </ng-container>
        <ng-container *ngIf="!record.id">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="tableForm.controls['nameCreateField']" placeholder="Name" name="name"
              [(ngModel)]="createRecord.name" value="{{createRecord.name}}">
          </mat-form-field>
        </ng-container>
      </td>
      <td></td>
    </ng-container>

    <ng-container matColumnDef="surname">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Surname </th>
      <td mat-cell *matCellDef="let record">
        <ng-container *ngIf="record.id && record.id !== editedRecordId">
          {{record.surname}}
        </ng-container>
        <ng-container *ngIf="record.id && record.id === editedRecordId">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="tableForm.controls['surnameEditField']" placeholder="{{editRecord.surname}}"
              name="surname" [(ngModel)]="editRecord.surname" value="{{record.surname}}">
            <mat-hint
              *ngIf="tableForm.controls['surnameEditField'].errors && tableForm.controls['surnameEditField'].errors['required']"
              class="error"> This field is required </mat-hint>
          </mat-form-field>
        </ng-container>
        <ng-container *ngIf="!record.id">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="tableForm.controls['surnameCreateField']" placeholder="Surname"
              name="surname" [(ngModel)]="createRecord.surname" value="{{createRecord.surname}}">
          </mat-form-field>
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="send_mail_at">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> Send mail at </th>
      <td mat-cell *matCellDef="let record">
        <ng-container *ngIf="record.id">
          {{record.send_mail_at}}
        </ng-container>
        <ng-container *ngIf="!record.id">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="tableForm.controls['sendMailAtCreateField']" placeholder="Date in ISO format"
              name="send_mail_at" [(ngModel)]="createRecord.send_mail_at" value="{{createRecord.send_mail_at}}">
          </mat-form-field>
        </ng-container>
      </td>
    </ng-container>

    <ng-container matColumnDef="hash">
      <th mat-header-cell *matHeaderCellDef> Hash </th>
      <td mat-cell *matCellDef="let record"> {{record.hash}} </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Actions <button mat-raised-button (click)="enableAddMode()" color="primary"
          [disabled]="bAddMode">Add</button> </th>
      <td mat-cell *matCellDef="let record">
        <ng-container *ngIf="record.id && record.id !== editedRecordId">
          <button mat-button (click)="deleteRecord(record.id)" color="warn">Delete</button>
          <button mat-button (click)="enableEditMode(record)" [disabled]="bEditMode">Edit</button>
        </ng-container>
        <ng-container *ngIf="record.id === editedRecordId">
          <button mat-button (click)="cancelEdit(record)" color="warn">Cancel</button>
          <button mat-button (click)="confirmEdit(record)" color="primary">Confirm</button>
        </ng-container>
        <ng-container *ngIf="!record.id">
          <button mat-button (click)="cancelAdd()" color="warn">Cancel</button>
          <button mat-button (click)="confirmAdd()" color="primary"
            [disabled]="tableForm.controls['surnameCreateField'].errors ||  tableForm.controls['nameCreateField'].errors">Add</button>
          </ng-container>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
  </table>
</form>
